# 高级打印功能使用示例

## 概述

本项目新增了 `printFileAdvanced` 方法，支持更精细的打印控制，包括分辨率、打印质量等高级选项。

## 原始命令分析

```bash
lp -d Brother_MFC_J3940DW -o media=A3 -o sides=two-sided-long-edge -o resolution=300dpi -o print-quality=5 -n 1 /home/orangepi/Scan2025-07-31_212035.pdf
```

**参数说明：**
- `-d Brother_MFC_J3940DW`: 指定打印机
- `-o media=A3`: A3纸张
- `-o sides=two-sided-long-edge`: 双面长边翻转
- `-o resolution=300dpi`: 300DPI分辨率
- `-o print-quality=5`: 最高打印质量
- `-n 1`: 打印1份

## 在项目中使用

### 方法1：使用高级打印方法

```cpp
#include "printmanager.h"

PrintManager printManager;

// 设置信号连接
connect(&printManager, &PrintManager::printStarted,
        [](const QString &device, const QString &jobName) {
    qDebug() << "打印开始:" << device << jobName;
});

connect(&printManager, &PrintManager::printCompleted,
        [](const QString &device, const QString &jobName, int jobId) {
    qDebug() << "打印完成:" << device << jobName << "ID:" << jobId;
});

connect(&printManager, &PrintManager::printError,
        [](const QString &device, const QString &error) {
    qDebug() << "打印错误:" << device << error;
});

// 执行高级打印
bool success = printManager.printFileAdvanced(
    "Brother_MFC_J3940DW",                    // 设备名称
    "/home/orangepi/Scan2025-07-31_212035.pdf", // 文件路径
    "A3",                                      // 纸张大小
    "two-sided-long-edge",                     // 双面设置
    300,                                       // 分辨率(DPI)
    5,                                         // 打印质量
    1,                                         // 打印份数
    "A3高质量打印"                              // 任务名称
);
```

### 方法2：使用自定义选项

```cpp
QStringList customOptions;
customOptions << "-o" << "media=A3";
customOptions << "-o" << "sides=two-sided-long-edge";
customOptions << "-o" << "resolution=300dpi";
customOptions << "-o" << "print-quality=5";
customOptions << "-n" << "1";

bool success = printManager.printFileWithOptions(
    "Brother_MFC_J3940DW",
    "/home/orangepi/Scan2025-07-31_212035.pdf",
    customOptions
);
```

### 方法3：在UI中集成

```cpp
// 在MainWindow中
void MainWindow::onAdvancedPrintClicked()
{
    QString deviceName = ui->printerComboBox->currentText();
    QString filePath = ui->filePathLineEdit->text();
    
    // 从UI获取参数
    QString media = ui->mediaComboBox->currentText();
    QString sides = ui->sidesComboBox->currentText();
    int resolution = ui->resolutionSpinBox->value();
    int quality = ui->qualitySpinBox->value();
    int copies = ui->copiesSpinBox->value();
    
    // 执行打印
    m_printManager->printFileAdvanced(deviceName, filePath, 
                                     media, sides, resolution, 
                                     quality, copies, "高级打印");
}
```

## 支持的参数

### 纸张大小 (media)
- `A4`: 标准A4纸张
- `A3`: A3纸张
- `Letter`: 信纸大小
- `Legal`: 法律文件大小

### 双面设置 (sides)
- `one-sided`: 单面打印
- `two-sided-long-edge`: 双面长边翻转
- `two-sided-short-edge`: 双面短边翻转

### 分辨率 (resolution)
- 范围: 72-1200 DPI
- 常用值: 150, 300, 600 DPI

### 打印质量 (print-quality)
- 1: 草稿质量
- 3: 标准质量
- 5: 最高质量

## 错误处理

```cpp
connect(&printManager, &PrintManager::printError,
        [](const QString &device, const QString &error) {
    // 显示错误信息
    QMessageBox::warning(nullptr, "打印错误", 
                        QString("设备: %1\n错误: %2").arg(device, error));
});
```

## 测试功能

运行测试函数来验证功能：

```cpp
#include "test_functions.h"

// 测试高级打印功能
testAdvancedPrinting();

// 测试等效命令
testEquivalentCommands();
```

## 注意事项

1. **文件路径**: 确保文件路径正确且文件存在
2. **打印机名称**: 使用 `getAvailablePrinters()` 获取可用打印机列表
3. **权限**: 确保程序有执行 `lp` 命令的权限
4. **网络打印机**: 对于网络打印机，确保网络连接正常
5. **A3纸张**: 使用A3纸张时，系统会自动添加 `fit-to-page` 和 `scaling=100` 选项

## 调试信息

启用调试模式查看详细命令：

```cpp
// 在printmanager.cpp中，命令会被输出到调试控制台
qDebug() << "Starting advanced print with command: lp" << args;
```

这将显示实际执行的 `lp` 命令，便于调试和验证。 