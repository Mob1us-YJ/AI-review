# AI阅卷系统简化架构使用示例

## 🎯 架构概述

采用简化方案，将功能按职责分离：

- **DeviceManager**: 设备发现、选择、状态管理
- **ScanManager**: 扫描命令构建和执行
- **PrintManager**: 打印命令构建和执行

## 📋 使用示例

### 1. 初始化管理器

```cpp
// 在MainWindow构造函数中
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow),
    m_networkManager(new NetworkManager(this)),
    m_scanManager(new ScanManager(this)),
    m_printManager(new PrintManager(this)),
    m_examManager(new ExamManager(this)),
    m_deviceManager(new DeviceManager(this)),  // 设备管理器
    m_refreshTimer(new QTimer(this))
{
    // 初始化设备管理器
    initializeDeviceManager();
    
    // 设置连接
    setupConnections();
}
```

### 2. 设备发现和选择

```cpp
// 发现所有设备
QStringList allDevices = m_deviceManager->discoverDevices();
qDebug() << "发现设备:" << allDevices;

// 获取多功能一体机
QStringList multifunctionDevices = m_deviceManager->getMultifunctionDevices();
qDebug() << "多功能一体机:" << multifunctionDevices;

// 选择设备
if (!multifunctionDevices.isEmpty()) {
    QString deviceName = multifunctionDevices.first();
    m_deviceManager->selectDevice(deviceName);
    qDebug() << "选择设备:" << deviceName;
}
```

### 3. 扫描功能

```cpp
// 设置扫描参数
m_scanManager->setScanSettings("Brother_MFC_J3940DW", 300, "jpeg", "Color", true);

// 单页扫描
bool success = m_scanManager->startScan("Brother_MFC_J3940DW", "/path/to/output.jpg");

// 批量扫描
bool success = m_scanManager->startBatchScan("Brother_MFC_J3940DW", 
                                           "2025年上第一次月考", 
                                           "高一（13）", 
                                           "数学", 
                                           6);
```

### 4. 打印功能

```cpp
// 设置打印参数
m_printManager->setPrintSettings("Brother_MFC_J3940DW", 1, "A3", "two-sided-long-edge");

// 打印文件
bool success = m_printManager->printFile("Brother_MFC_J3940DW", 
                                       "/path/to/file.pdf", 
                                       "打印任务名称");
```

### 5. 信号连接

```cpp
// 设备管理信号
connect(m_deviceManager, &DeviceManager::deviceDiscovered,
        [this](const QString &deviceName, const QString &deviceType) {
    qDebug() << "发现设备:" << deviceName << "类型:" << deviceType;
});

connect(m_deviceManager, &DeviceManager::deviceSelected,
        [this](const QString &deviceName) {
    qDebug() << "选择设备:" << deviceName;
});

// 扫描信号
connect(m_scanManager, &ScanManager::scanStarted,
        [this](const QString &deviceName) {
    qDebug() << "扫描开始，设备:" << deviceName;
});

connect(m_scanManager, &ScanManager::scanCompleted,
        [this](const QString &deviceName, const QString &filePath) {
    qDebug() << "扫描完成，设备:" << deviceName << "文件:" << filePath;
    // 自动上传扫描文件
    m_scanManager->uploadFile(deviceName, filePath, "/exam/");
});

// 打印信号
connect(m_printManager, &PrintManager::printStarted,
        [this](const QString &deviceName, const QString &jobName) {
    qDebug() << "打印开始，设备:" << deviceName << "任务:" << jobName;
});

connect(m_printManager, &PrintManager::printCompleted,
        [this](const QString &deviceName, const QString &jobName, int jobId) {
    qDebug() << "打印完成，设备:" << deviceName << "任务:" << jobName << "ID:" << jobId;
});
```

### 6. 界面按钮处理

```cpp
void MainWindow::onFormScanButtonClicked(const QString &taskId, const QString &className, const QString &subject)
{
    // 获取当前选择的设备
    QString currentDevice = m_deviceManager->getCurrentDevice();
    if (currentDevice.isEmpty()) {
        // 选择第一个多功能一体机
        QStringList multifunctionDevices = m_deviceManager->getMultifunctionDevices();
        if (!multifunctionDevices.isEmpty()) {
            currentDevice = multifunctionDevices.first();
            m_deviceManager->selectDevice(currentDevice);
        }
    }
    
    if (!currentDevice.isEmpty()) {
        // 调用设备扫描功能
        onDeviceScanRequested(currentDevice, taskId, className, subject);
    }
}

void MainWindow::onDeviceScanRequested(const QString &deviceName, const QString &taskId, 
                                      const QString &className, const QString &subject)
{
    // 设置扫描参数
    m_scanManager->setScanSettings(deviceName, 300, "jpeg", "Color", true);
    
    // 开始批量扫描
    bool success = m_scanManager->startBatchScan(deviceName, "2025年上第一次月考", 
                                               className, subject, 6);
    if (success) {
        qDebug() << "✓ 批量扫描启动成功";
    }
}
```

## 🔧 优势分析

### ✅ 简化后的优势

1. **职责清晰**: 每个管理器专注于自己的功能
2. **代码简洁**: 减少了重复代码
3. **易于维护**: 功能分离，便于调试和修改
4. **扩展性好**: 可以轻松添加新的设备类型
5. **符合实际**: 多功能一体机作为统一设备管理

### 📊 架构对比

| 功能 | DeviceManager | ScanManager | PrintManager |
|------|---------------|-------------|--------------|
| 设备发现 | ✅ | ❌ | ❌ |
| 设备选择 | ✅ | ❌ | ❌ |
| 设备状态 | ✅ | ❌ | ❌ |
| 扫描功能 | ❌ | ✅ | ❌ |
| 打印功能 | ❌ | ❌ | ✅ |
| 上传功能 | ❌ | ✅ | ❌ |

## 🎉 总结

简化后的架构更加清晰和实用：

- **DeviceManager** 负责设备层面的管理
- **ScanManager** 专注于扫描功能
- **PrintManager** 专注于打印功能
- **主窗口** 协调各个管理器的工作

这样的设计既保持了功能的完整性，又简化了代码结构，更符合实际使用场景。 