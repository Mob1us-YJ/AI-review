# AIé˜…å·ç³»ç»Ÿç®€åŒ–æ¶æ„ä½¿ç”¨ç¤ºä¾‹

## ğŸ¯ æ¶æ„æ¦‚è¿°

é‡‡ç”¨ç®€åŒ–æ–¹æ¡ˆï¼Œå°†åŠŸèƒ½æŒ‰èŒè´£åˆ†ç¦»ï¼š

- **DeviceManager**: è®¾å¤‡å‘ç°ã€é€‰æ‹©ã€çŠ¶æ€ç®¡ç†
- **ScanManager**: æ‰«æå‘½ä»¤æ„å»ºå’Œæ‰§è¡Œ
- **PrintManager**: æ‰“å°å‘½ä»¤æ„å»ºå’Œæ‰§è¡Œ

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆå§‹åŒ–ç®¡ç†å™¨

```cpp
// åœ¨MainWindowæ„é€ å‡½æ•°ä¸­
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow),
    m_networkManager(new NetworkManager(this)),
    m_scanManager(new ScanManager(this)),
    m_printManager(new PrintManager(this)),
    m_examManager(new ExamManager(this)),
    m_deviceManager(new DeviceManager(this)),  // è®¾å¤‡ç®¡ç†å™¨
    m_refreshTimer(new QTimer(this))
{
    // åˆå§‹åŒ–è®¾å¤‡ç®¡ç†å™¨
    initializeDeviceManager();
    
    // è®¾ç½®è¿æ¥
    setupConnections();
}
```

### 2. è®¾å¤‡å‘ç°å’Œé€‰æ‹©

```cpp
// å‘ç°æ‰€æœ‰è®¾å¤‡
QStringList allDevices = m_deviceManager->discoverDevices();
qDebug() << "å‘ç°è®¾å¤‡:" << allDevices;

// è·å–å¤šåŠŸèƒ½ä¸€ä½“æœº
QStringList multifunctionDevices = m_deviceManager->getMultifunctionDevices();
qDebug() << "å¤šåŠŸèƒ½ä¸€ä½“æœº:" << multifunctionDevices;

// é€‰æ‹©è®¾å¤‡
if (!multifunctionDevices.isEmpty()) {
    QString deviceName = multifunctionDevices.first();
    m_deviceManager->selectDevice(deviceName);
    qDebug() << "é€‰æ‹©è®¾å¤‡:" << deviceName;
}
```

### 3. æ‰«æåŠŸèƒ½

```cpp
// è®¾ç½®æ‰«æå‚æ•°
m_scanManager->setScanSettings("Brother_MFC_J3940DW", 300, "jpeg", "Color", true);

// å•é¡µæ‰«æ
bool success = m_scanManager->startScan("Brother_MFC_J3940DW", "/path/to/output.jpg");

// æ‰¹é‡æ‰«æ
bool success = m_scanManager->startBatchScan("Brother_MFC_J3940DW", 
                                           "2025å¹´ä¸Šç¬¬ä¸€æ¬¡æœˆè€ƒ", 
                                           "é«˜ä¸€ï¼ˆ13ï¼‰", 
                                           "æ•°å­¦", 
                                           6);
```

### 4. æ‰“å°åŠŸèƒ½

```cpp
// è®¾ç½®æ‰“å°å‚æ•°
m_printManager->setPrintSettings("Brother_MFC_J3940DW", 1, "A3", "two-sided-long-edge");

// æ‰“å°æ–‡ä»¶
bool success = m_printManager->printFile("Brother_MFC_J3940DW", 
                                       "/path/to/file.pdf", 
                                       "æ‰“å°ä»»åŠ¡åç§°");
```

### 5. ä¿¡å·è¿æ¥

```cpp
// è®¾å¤‡ç®¡ç†ä¿¡å·
connect(m_deviceManager, &DeviceManager::deviceDiscovered,
        [this](const QString &deviceName, const QString &deviceType) {
    qDebug() << "å‘ç°è®¾å¤‡:" << deviceName << "ç±»å‹:" << deviceType;
});

connect(m_deviceManager, &DeviceManager::deviceSelected,
        [this](const QString &deviceName) {
    qDebug() << "é€‰æ‹©è®¾å¤‡:" << deviceName;
});

// æ‰«æä¿¡å·
connect(m_scanManager, &ScanManager::scanStarted,
        [this](const QString &deviceName) {
    qDebug() << "æ‰«æå¼€å§‹ï¼Œè®¾å¤‡:" << deviceName;
});

connect(m_scanManager, &ScanManager::scanCompleted,
        [this](const QString &deviceName, const QString &filePath) {
    qDebug() << "æ‰«æå®Œæˆï¼Œè®¾å¤‡:" << deviceName << "æ–‡ä»¶:" << filePath;
    // è‡ªåŠ¨ä¸Šä¼ æ‰«ææ–‡ä»¶
    m_scanManager->uploadFile(deviceName, filePath, "/exam/");
});

// æ‰“å°ä¿¡å·
connect(m_printManager, &PrintManager::printStarted,
        [this](const QString &deviceName, const QString &jobName) {
    qDebug() << "æ‰“å°å¼€å§‹ï¼Œè®¾å¤‡:" << deviceName << "ä»»åŠ¡:" << jobName;
});

connect(m_printManager, &PrintManager::printCompleted,
        [this](const QString &deviceName, const QString &jobName, int jobId) {
    qDebug() << "æ‰“å°å®Œæˆï¼Œè®¾å¤‡:" << deviceName << "ä»»åŠ¡:" << jobName << "ID:" << jobId;
});
```

### 6. ç•Œé¢æŒ‰é’®å¤„ç†

```cpp
void MainWindow::onFormScanButtonClicked(const QString &taskId, const QString &className, const QString &subject)
{
    // è·å–å½“å‰é€‰æ‹©çš„è®¾å¤‡
    QString currentDevice = m_deviceManager->getCurrentDevice();
    if (currentDevice.isEmpty()) {
        // é€‰æ‹©ç¬¬ä¸€ä¸ªå¤šåŠŸèƒ½ä¸€ä½“æœº
        QStringList multifunctionDevices = m_deviceManager->getMultifunctionDevices();
        if (!multifunctionDevices.isEmpty()) {
            currentDevice = multifunctionDevices.first();
            m_deviceManager->selectDevice(currentDevice);
        }
    }
    
    if (!currentDevice.isEmpty()) {
        // è°ƒç”¨è®¾å¤‡æ‰«æåŠŸèƒ½
        onDeviceScanRequested(currentDevice, taskId, className, subject);
    }
}

void MainWindow::onDeviceScanRequested(const QString &deviceName, const QString &taskId, 
                                      const QString &className, const QString &subject)
{
    // è®¾ç½®æ‰«æå‚æ•°
    m_scanManager->setScanSettings(deviceName, 300, "jpeg", "Color", true);
    
    // å¼€å§‹æ‰¹é‡æ‰«æ
    bool success = m_scanManager->startBatchScan(deviceName, "2025å¹´ä¸Šç¬¬ä¸€æ¬¡æœˆè€ƒ", 
                                               className, subject, 6);
    if (success) {
        qDebug() << "âœ“ æ‰¹é‡æ‰«æå¯åŠ¨æˆåŠŸ";
    }
}
```

## ğŸ”§ ä¼˜åŠ¿åˆ†æ

### âœ… ç®€åŒ–åçš„ä¼˜åŠ¿

1. **èŒè´£æ¸…æ™°**: æ¯ä¸ªç®¡ç†å™¨ä¸“æ³¨äºè‡ªå·±çš„åŠŸèƒ½
2. **ä»£ç ç®€æ´**: å‡å°‘äº†é‡å¤ä»£ç 
3. **æ˜“äºç»´æŠ¤**: åŠŸèƒ½åˆ†ç¦»ï¼Œä¾¿äºè°ƒè¯•å’Œä¿®æ”¹
4. **æ‰©å±•æ€§å¥½**: å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„è®¾å¤‡ç±»å‹
5. **ç¬¦åˆå®é™…**: å¤šåŠŸèƒ½ä¸€ä½“æœºä½œä¸ºç»Ÿä¸€è®¾å¤‡ç®¡ç†

### ğŸ“Š æ¶æ„å¯¹æ¯”

| åŠŸèƒ½ | DeviceManager | ScanManager | PrintManager |
|------|---------------|-------------|--------------|
| è®¾å¤‡å‘ç° | âœ… | âŒ | âŒ |
| è®¾å¤‡é€‰æ‹© | âœ… | âŒ | âŒ |
| è®¾å¤‡çŠ¶æ€ | âœ… | âŒ | âŒ |
| æ‰«æåŠŸèƒ½ | âŒ | âœ… | âŒ |
| æ‰“å°åŠŸèƒ½ | âŒ | âŒ | âœ… |
| ä¸Šä¼ åŠŸèƒ½ | âŒ | âœ… | âŒ |

## ğŸ‰ æ€»ç»“

ç®€åŒ–åçš„æ¶æ„æ›´åŠ æ¸…æ™°å’Œå®ç”¨ï¼š

- **DeviceManager** è´Ÿè´£è®¾å¤‡å±‚é¢çš„ç®¡ç†
- **ScanManager** ä¸“æ³¨äºæ‰«æåŠŸèƒ½
- **PrintManager** ä¸“æ³¨äºæ‰“å°åŠŸèƒ½
- **ä¸»çª—å£** åè°ƒå„ä¸ªç®¡ç†å™¨çš„å·¥ä½œ

è¿™æ ·çš„è®¾è®¡æ—¢ä¿æŒäº†åŠŸèƒ½çš„å®Œæ•´æ€§ï¼Œåˆç®€åŒ–äº†ä»£ç ç»“æ„ï¼Œæ›´ç¬¦åˆå®é™…ä½¿ç”¨åœºæ™¯ã€‚ 